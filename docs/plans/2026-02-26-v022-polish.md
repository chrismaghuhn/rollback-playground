# v0.2-2 Release Hygiene + Mini-Polish Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Update CHANGELOG/README for the v0.2-2 release, clean up `.gitignore`, and add three small UX improvements to `RollbackDemo.cs` (richer debug overlay + F1/F2 hotkeys).

**Architecture:** All changes are purely additive. No changes to `Core.Sim`, `Core.Rollback`, or `Core.Replay`. Docs items 1A/1C are configuration (TDD exception). Item 1B is documentation. Item 3 (`RollbackDemo.cs`) is a Godot rendering/presentation layer â€” the only verifiable test is `dotnet build game/game.csproj` (0 errors) and visual inspection in Godot editor.

**Tech Stack:** Markdown, `.gitignore`, C# 11 / net8.0, Godot 4.6.1 (`Godot.NET.Sdk/4.6.1`).

---

## Task 1: CHANGELOG + `.gitignore`

**Files:**
- Modify: `CHANGELOG.md`
- Modify: `.gitignore`

**Step 1: Update `CHANGELOG.md`**

Insert a new `[v0.2]` block **between** the `## [Unreleased]` block and the existing `## [v0.1-mvp]` block.

Current line 10â€“12:
```markdown
## [Unreleased]

---
```

After that separator (`---`), insert:
```markdown

## [v0.2] â€” 2026-02-26

### Added
- Multi-target `net8.0;net10.0` for `Core.Sim`, `Core.Rollback`, `Core.Replay`
  (Godot 4 compatibility â€” Godot requires `net8.0`).
- **Godot 4.6.1 offline rollback demo** (`game/`)
  - Single-script `Node2D` â€” `RollbackDemo.cs`, six labelled sections.
  - P1 keyboard: A / D / Space / J (Left / Right / Jump / Attack).
  - P2 deterministic 60-frame script: Right 0â€“29 â†’ Left 30â€“44 â†’ Jump 45â€“59.
  - Lag slider 0â€“10 frames (simulates network delay, triggers visible rollbacks).
  - Debug overlay: Frame, LatestRemote, Remote (PRED/CONF), RollbackCount,
    MaxRollback, FramesRolled, DelayFrames.
  - F1 toggles debug overlay; F2 toggles full HUD (overlay + slider).
  - Dark arena background, HP bars, facing indicator strips.

---
```

Also replace the footer link block at the bottom (lines 80â€“82):
```markdown
[Unreleased]: https://github.com/example/rollback-playground/compare/v0.1-mvp...HEAD
[v0.1-mvp]:   https://github.com/example/rollback-playground/releases/tag/v0.1-mvp
```
â†’
```markdown
[Unreleased]: https://github.com/example/rollback-playground/compare/v0.2...HEAD
[v0.2]:       https://github.com/example/rollback-playground/compare/v0.1-mvp...v0.2
[v0.1-mvp]:   https://github.com/example/rollback-playground/releases/tag/v0.1-mvp
```

**Step 2: Update `.gitignore`**

Append one line to the `# â”€â”€ OS` section at the bottom of `.gitignore`:

Current last lines:
```
# â”€â”€ OS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
.DS_Store
Thumbs.db
desktop.ini
```
â†’
```
# â”€â”€ OS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
.DS_Store
Thumbs.db
desktop.ini
.claude/
```

**Step 3: Verify git status**

```bash
cd "C:\Users\chris\Documents\neues projekt" && git status
```

Expected: `.claude/` is now listed in `.gitignore` â€” it should disappear from the untracked list.

**Step 4: Commit**

```bash
git add CHANGELOG.md .gitignore
git commit -m "chore: add v0.2 CHANGELOG entry, ignore .claude/ in gitignore"
```

---

## Task 2: README Updates

**Files:**
- Modify: `README.md`

**Step 1: Update the Status table and add "Run the Demo" section**

Current `README.md` (lines 34â€“38):
```markdown
## Status

| Milestone | Status |
|-----------|--------|
| MVP v0.1 (Core.Sim + Rollback + Replay) | ðŸš§ In progress |
| v0.2 (UDP netcode + desync detection)   | ðŸ“‹ Planned |
```

Replace with:
```markdown
## Status

| Milestone | Status |
|-----------|--------|
| v0.1-mvp (Core.Sim + Rollback + Replay)   | âœ… Done    |
| v0.2 (Godot offline demo + multi-target)  | âœ… Done    |
| v0.3 (LAN UDP netcode + desync detection) | ðŸ“‹ Planned |

<!-- GIF: record ~12s â€” Lag 0 â†’ 5 â†’ 0, watch RollbackCount climb -->
<!-- Place recording at docs/rollback-demo.gif then uncomment: -->
<!-- ![Rollback Demo â€” Lag slider + debug overlay](docs/rollback-demo.gif) -->
```

**Step 2: Insert "Run the Demo" section**

Insert **after** `## Quickstart` and its closing code block (after line 21), before `## Hard Rules`:

```markdown

## Run the Demo

> **Prerequisites:** [Godot 4 .NET](https://godotengine.org/download/) (v4.6+, must include .NET support) Â· [.NET 8 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)

1. Open Godot 4 â†’ **Import** â†’ select the `game/` folder â†’ **Import & Edit**
2. Press **F5** (or â–¶ Play) to run
3. Control P1 with **A / D** (move) Â· **Space** (jump) Â· **J** (attack)
4. Drag the **Lag slider** (top-right) to simulate network delay

| Lag slider | What you see |
|---|---|
| 0 frames | `RollbackCount` stays 0 â€” all inputs arrive on time |
| > 0 frames | `RollbackCount` increments every ~30 frames (P2 phase change triggers mismatch) |
| 5 frames | `MaxRollback` stabilises at 5 â€” 5-frame resimulation on each phase boundary |

**Hotkeys:** `F1` â€” toggle debug overlay Â· `F2` â€” toggle full HUD

```

Also update line 13 of `README.md`:
```markdown
The `game/` directory contains a Godot 4 project (future visual frontend, out of scope for MVP v0.1).
```
â†’
```markdown
The `game/` directory contains a Godot 4.6.1 `.NET` demo â€” see [Run the Demo](#run-the-demo).
```

**Step 3: Commit**

```bash
git add README.md
git commit -m "docs: add Run the Demo section, update status table to v0.2 done"
```

---

## Task 3: `game/RollbackDemo.cs` â€” Mini-Polish

**Files:**
- Modify: `game/RollbackDemo.cs`

No TDD applies (Godot rendering script). Verification = `dotnet build game/game.csproj` with 0 errors.

The changes are four targeted edits to the existing file. Make them in order.

**Step 1: Add `_hud`, `_latestRemoteFrame`, `_overlayVisible`, `_hudVisible` fields**

In the `// â”€â”€â”€ Godot lifecycle` section (around line 45â€“49), the current field block is:
```csharp
    private RollbackEngine _engine    = null!;
    private Label          _debugLbl  = null!;
    private Label          _lagLbl    = null!;
```

Replace with:
```csharp
    private RollbackEngine _engine    = null!;
    private CanvasLayer    _hud       = null!;
    private Label          _debugLbl  = null!;
    private Label          _lagLbl    = null!;
```

In the `// â”€â”€â”€ Lag simulation + delivery` section (around line 87â€“90), after the existing comment+field block:
```csharp
    // Written from the UI thread (ValueChanged); read from the physics thread (_PhysicsProcess).
    // Safe only with Godot's single-threaded physics (the default).
    private int _delayFrames = 0;
```

Append three new fields:
```csharp
    // Highest simFrame for which a confirmed remote input has been delivered.
    // uint.MaxValue = "never delivered" â€” same sentinel pattern as InputBuffer / StateBuffer.
    private uint _latestRemoteFrame = uint.MaxValue;

    // HUD visibility (F1 = debug label only; F2 = full HUD including slider).
    private bool _overlayVisible = true;
    private bool _hudVisible     = true;
```

**Step 2: Update `BuildUi()` to assign `_hud` and use it throughout**

In `BuildUi()` (around line 161â€“163), change:
```csharp
        var hud = new CanvasLayer();
        AddChild(hud);
```
â†’
```csharp
        _hud = new CanvasLayer();
        AddChild(_hud);
```

Then replace **every** `hud.AddChild(` call in `BuildUi()` with `_hud.AddChild(`. There are three:
- `hud.AddChild(_debugLbl);` â†’ `_hud.AddChild(_debugLbl);`
- `hud.AddChild(row);` â†’ `_hud.AddChild(row);`

(The third is the `hud.AddChild(_debugLbl)` after position/font setup.)

**Step 3: Update `DeliverDue` to track `_latestRemoteFrame`**

Current `DeliverDue` (lines 113â€“121):
```csharp
    private void DeliverDue(uint currentFrame)
    {
        while (_lagBuffer.Count > 0 && _lagBuffer.Peek().deliveryAt <= currentFrame)
        {
            var (_, simFrame, input) = _lagBuffer.Dequeue();
            _engine.SetRemoteInput(simFrame, input);
        }
    }
```

Replace with:
```csharp
    private void DeliverDue(uint currentFrame)
    {
        while (_lagBuffer.Count > 0 && _lagBuffer.Peek().deliveryAt <= currentFrame)
        {
            var (_, simFrame, input) = _lagBuffer.Dequeue();
            _engine.SetRemoteInput(simFrame, input);

            // Use Math.Max to stay monotone even if queue order shifts after a
            // live delay-slider change produces out-of-order deliveries.
            _latestRemoteFrame = _latestRemoteFrame == uint.MaxValue
                ? simFrame
                : Math.Max(_latestRemoteFrame, simFrame);
        }
    }
```

**Step 4: Replace `UpdateDebugLabel` with the 7-line extended version**

Current `UpdateDebugLabel` (lines 200â€“208):
```csharp
    private void UpdateDebugLabel()
    {
        _debugLbl.Text =
            $"Frame:         {_engine.CurrentFrame,7}\n"       +
            $"RollbackCount: {_engine.RollbackCount,7}\n"      +
            $"MaxRollback:   {_engine.MaxRollbackDepth,7} frames\n" +
            $"FramesRolled:  {_engine.RollbackFramesTotal,7}\n" +
            $"DelayFrames:   {_delayFrames,7}";
    }
```

Replace with:
```csharp
    private void UpdateDebugLabel()
    {
        // Determine PRED/CONF for the frame that was just simulated.
        // Tick() has already incremented CurrentFrame, so the frame we care about
        // is CurrentFrame - 1.  Making this explicit prevents off-by-one "fixes".
        uint justSimulated = _engine.CurrentFrame == 0u ? 0u : _engine.CurrentFrame - 1u;
        bool confirmedForJustSimulated =
            _latestRemoteFrame != uint.MaxValue &&
            _latestRemoteFrame >= justSimulated;

        string remoteStatus    = _latestRemoteFrame == uint.MaxValue ? "N/A "
                               : confirmedForJustSimulated            ? "CONF" : "PRED";
        string latestRemoteTxt = _latestRemoteFrame == uint.MaxValue
                               ? "    ---"
                               : $"{_latestRemoteFrame,7}";

        _debugLbl.Text =
            $"Frame:          {_engine.CurrentFrame,7}\n"           +
            $"LatestRemote:  {latestRemoteTxt}\n"                   +
            $"Remote:        {remoteStatus,7}\n"                    +
            $"RollbackCount: {_engine.RollbackCount,7}\n"           +
            $"MaxRollback:   {_engine.MaxRollbackDepth,7} frames\n" +
            $"FramesRolled:  {_engine.RollbackFramesTotal,7}\n"     +
            $"DelayFrames:   {_delayFrames,7}";
    }
```

**Step 5: Add `_UnhandledInput` override**

Append the following new method inside the class, after `UpdateDebugLabel` and before the closing `}` of the class:

```csharp
    // â”€â”€â”€ Hotkeys â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    public override void _UnhandledInput(InputEvent @event)
    {
        if (@event is not InputEventKey { Pressed: true, Echo: false } key)
            return;

        if (key.Keycode == Key.F1)
        {
            _overlayVisible   = !_overlayVisible;
            _debugLbl.Visible = _overlayVisible;
        }
        else if (key.Keycode == Key.F2)
        {
            _hudVisible  = !_hudVisible;
            _hud.Visible = _hudVisible;
        }
    }
```

**Step 6: Build â€” verify 0 errors**

```bash
dotnet build "C:\Users\chris\Documents\neues projekt\game\game.csproj"
```

Expected:
```
Der Buildvorgang wurde erfolgreich ausgefÃ¼hrt.
    0 Warnung(en)
    0 Fehler
```

If there are errors, fix them before committing.

**Step 7: Commit**

```bash
git add game/RollbackDemo.cs
git commit -m "feat(game): overlay LatestRemote+PRED/CONF, F1 debug toggle, F2 HUD toggle"
```

---

## Task 4: Final Verification

**Step 1: Core test suite**

```bash
dotnet test "C:\Users\chris\Documents\neues projekt\RollbackPlayground.sln"
```

Expected: 68 passed (40 + 20 + 8), 0 failed.

**Step 2: Release build (core)**

```bash
dotnet build "C:\Users\chris\Documents\neues projekt\RollbackPlayground.sln" -c Release
```

Expected: `0 Warning(s)  0 Error(s)`

**Step 3: Git status clean**

```bash
git status
```

Expected: `nothing to commit, working tree clean` (only `.claude/` untracked, now ignored).

**Step 4: Tag**

```bash
git tag -a v0.2-3 -m "v0.2-3: release hygiene + overlay polish (LatestRemote, PRED/CONF, F1/F2)"
git show v0.2-3 --stat
```

Expected: tag points to the latest commit (Task 3 commit).
